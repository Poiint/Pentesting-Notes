## FTP

TCP listens on port TCP 21, and transmits data on port 20. There are two modes: active and passive. Data is not encrypted so it's sent in clear-text.
There is the possibility to login as anonymous. Some FTP commands:

|**Commands**|**Description**|
|---|---|
|`connect`|Sets the remote host, and optionally the port, for file transfers.|
|`get`|Transfers a file or set of files from the remote host to the local host.|
|`put`|Transfers a file or set of files from the local host onto the remote host.|
|`quit`|Exits tftp.|
|`status`|Shows the current status of tftp, including the current transfer mode (ascii or binary), connection status, time-out value, and so on.|
|`verbose`|Turns verbose mode, which displays additional information during file transfer, on or off.|
| `ls -R` | Recursive listing |

Default configuration can be found in "**/etc/vsftpd.conf**" ( or in whatever FPT version).
FTP users can be found in "**/etc/ftpusers**".
These are some dangerous settings in FTP:

|**Setting**|**Description**|
|---|---|
|`anonymous_enable=YES`|Allowing anonymous login?|
|`anon_upload_enable=YES`|Allowing anonymous to upload files?|
|`anon_mkdir_write_enable=YES`|Allowing anonymous to create new directories?|
|`no_anon_password=YES`|Do not ask anonymous for password?|
|`anon_root=/home/username/ftp`|Directory for anonymous.|
|`write_enable=YES`|Allow the usage of FTP commands: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE, and SITE?|

It's possible that the firewall blocks the connection from the outside (active) if that happens, switch to a passive mode. In general you want to login anonymously or with found credentials and try to get some file or put some reverse shell.
These are some nmap script for ftp:

```shell-session
find / -type f -name ftp* 2>/dev/null | grep scripts

/usr/share/nmap/scripts/ftp-syst.nse
/usr/share/nmap/scripts/ftp-vsftpd-backdoor.nse
/usr/share/nmap/scripts/ftp-vuln-cve2010-4221.nse
/usr/share/nmap/scripts/ftp-proftpd-backdoor.nse
/usr/share/nmap/scripts/ftp-bounce.nse
/usr/share/nmap/scripts/ftp-libopie.nse
/usr/share/nmap/scripts/ftp-anon.nse
/usr/share/nmap/scripts/ftp-brute.nse
```

## SMB 

SMB listens on port TCP 137, 138, 139 and CIFS 445 (the new version, a dialect).
From version 3, SMB gained the ability to be a full member of Active Directory.
The default configuration file can be found in "**/etc/samba/smb.conf**".
These are some dangerous settings: [[2. FOOTPRINTING_cheatsheet#FTP]]

|**Setting**|**Description**|
|---|---|
|`browseable = yes`|Allow listing available shares in the current share?|
|`read only = no`|Forbid the creation and modification of files?|
|`writable = yes`|Allow users to create and modify files?|
|`guest ok = yes`|Allow connecting to the service without using a password?|
|`enable privileges = yes`|Honor privileges assigned to specific SID?|
|`create mask = 0777`|What permissions must be assigned to the newly created files?|
|`directory mask = 0777`|What permissions must be assigned to the newly created directories?|
|`logon script = script.sh`|What script needs to be executed on the user's login?|
|`magic script = script.sh`|Which script should be executed when the script gets closed?|
|`magic output = script.out`|Where the output of the magic script needs to be stored?|

This is an example of a Share:

```shell-session
[notes]
	comment = CheckIT
	path = /mnt/notes/

	browseable = yes
	read only = no
	writable = yes
	guest ok = yes

	enable privileges = yes
	create mask = 0777
	directory mask = 0777

	THEN

	sudo systemctl restart smbd (to restart the service)
```

We can try to enumerate the shares using some tools (like smbclient) with a null (-N) session, if we are to do so we can access those shares and try to obtain some important information [[2. FOOTPRINTING_cheatsheet#SMB]] to see the tools.
We can also use rpcclient with these query to get informations:

|**Query**|**Description**|
|---|---|
|`srvinfo`|Server information.|
|`enumdomains`|Enumerate all domains that are deployed in the network.|
|`querydominfo`|Provides domain, server, and user information of deployed domains.|
|`netshareenumall`|Enumerates all available shares.|
|`netsharegetinfo <share>`|Provides information about a specific share.|
|`enumdomusers`|Enumerates all domain users.|
|`queryuser <RID>`|Provides information about a specific user.|

Use more than a single tool because some tools could miss some information.





## NFS

NFS (Network File System) listens  on TCP port 2049 or UDP/TCP 111. Default configuration file can be found in "**/etc/exports**". These are some configuration options. [[2. FOOTPRINTING_cheatsheet#NFS]]

|**Option**|**Description**|
|---|---|
|`rw`|Read and write permissions.|
|`ro`|Read only permissions.|
|`sync`|Synchronous data transfer. (A bit slower)|
|`async`|Asynchronous data transfer. (A bit faster)|
|`secure`|Ports above 1024 will not be used.|
|`insecure`|Ports above 1024 will be used.|
|`no_subtree_check`|This option disables the checking of subdirectory trees.|
|`root_squash`|Assigns all permissions to files of root UID/GID 0 to the UID/GID of anonymous, which prevents `root` from accessing files on an NFS mount.|

We can add a mount in this way:

```shell-session
root@nfs:~# echo '/mnt/nfs  10.129.14.0/24(sync,no_subtree_check)' >> /etc/exports
root@nfs:~# systemctl restart nfs-kernel-server 
root@nfs:~# exportfs

/mnt/nfs      	10.129.14.0/24
```

These are some dangerous configurations:

|**Option**|**Description**|
|---|---|
|`rw`|Read and write permissions.|
|`insecure`|Ports above 1024 will be used.|
|`nohide`|If another file system was mounted below an exported directory, this directory is exported by its own exports entry.|
|`no_root_squash`|All files created by root are kept with the UID/GID 0.|

For example the option "insecure" is dangerous because only root can use the first 1024 ports, and in this configuration other users can use NFS.

Usually we try to show mounts (with showmount).
```shell-session
showmount -e 10.129.14.128

Export list for 10.129.14.128:
/mnt/nfs 10.129.14.0/24
```
Once we list them, we do that:
```shell-session
Poiint@htb[/htb]$ mkdir target-NFS
Poiint@htb[/htb]$ sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
Poiint@htb[/htb]$ cd target-NFS
Poiint@htb[/htb]$ tree .

.
└── mnt
    └── nfs
        ├── id_rsa
        ├── id_rsa.pub
        └── nfs.share

2 directories, 3 files
```

If "root_squash" option is setted, we can't modify these files even if we are <i>root</i>.

To unmount:
```shell-session
Poiint@htb[/htb]$ cd ..
Poiint@htb[/htb]$ sudo umount ./target-NFS
```

## DNS

DNS listens on port UDP 53. These are some DNS records: [[2. FOOTPRINTING_cheatsheet#DNS]]

|**DNS Record**|**Description**|
|---|---|
|`A`|Returns an IPv4 address of the requested domain as a result.|
|`AAAA`|Returns an IPv6 address of the requested domain.|
|`MX`|Returns the responsible mail servers as a result.|
|`NS`|Returns the DNS servers (nameservers) of the domain.|
|`TXT`|This record can contain various information. The all-rounder can be used, e.g., to validate the Google Search Console or validate SSL certificates. In addition, SPF and DMARC entries are set to validate mail traffic and protect it from spam.|
|`CNAME`|This record serves as an alias. If the domain www.hackthebox.eu should point to the same IP, and we create an A record for one and a CNAME record for the other.|
|`PTR`|The PTR record works the other way around (reverse lookup). It converts IP addresses into valid domain names.|
|`SOA`|Provides information about the corresponding DNS zone and email address of the administrative contact.|

We can use `dig <DNS record option> <FQDN/IP>` to do a query to the dns server. These are some dangerous settings:

|**Option**|**Description**|
|---|---|
|`allow-query`|Defines which hosts are allowed to send requests to the DNS server.|
|`allow-recursion`|Defines which hosts are allowed to send recursive requests to the DNS server.|
|`allow-transfer`|Defines which hosts are allowed to receive zone transfers from the DNS server.|
|`zone-statistics`|Collects statistical data of zones.|

We can dig DNS Records and try to get as much information as possible. We can also perform a "Zone Transfer" query, which transfers all the dns records so we can see them. To do a zone transfer we can use this dns query: `AXFR`.
If succesfull we will see a lot of DNS records, which we can use again to do a further DNS enumeration.
If DNS zone transfer doesn't work, we can brute force (check cheatsheet).

## SMTP

SMTP listens on port TCP 25 or 587. These are some SMTP commands: [[2. FOOTPRINTING_cheatsheet#SMTP]]

|**Command**|**Description**|
|---|---|
|`AUTH PLAIN`|AUTH is a service extension used to authenticate the client.|
|`HELO`|The client logs in with its computer name and thus starts the session.|
|`MAIL FROM`|The client names the email sender.|
|`RCPT TO`|The client names the email recipient.|
|`DATA`|The client initiates the transmission of the email.|
|`RSET`|The client aborts the initiated transmission but keeps the connection between client and server.|
|`VRFY`|The client checks if a mailbox is available for message transfer.|
|`EXPN`|The client also checks if a mailbox is available for messaging with this command.|
|`NOOP`|The client requests a response from the server to prevent disconnection due to time-out.|
|`QUIT`|The client terminates the session.|

Usually the VRFY command can be used to enumerate users in a system. This nmap script can be usefull to footprint the service:
`--script=smtp-open-relay`

## IMAP/POP3
By default, port 110, 143, 993 and 995 are used for IMAP and POP3, the two higher ports use TLS/SSL to encrypt the communication. Here are some important commands: [[2. FOOTPRINTING_cheatsheet#IMAP/POP3]]

#### IMAP Commands

|**Command**|**Description**|
|---|---|
|`1 LOGIN username password`|User's login.|
|`1 LIST "" *`|Lists all directories.|
|`1 CREATE "INBOX"`|Creates a mailbox with a specified name.|
|`1 DELETE "INBOX"`|Deletes a mailbox.|
|`1 RENAME "ToRead" "Important"`|Renames a mailbox.|
|`1 LSUB "" *`|Returns a subset of names from the set of names that the User has declared as being `active` or `subscribed`.|
|`1 SELECT INBOX`|Selects a mailbox so that messages in the mailbox can be accessed.|
|`1 UNSELECT INBOX`|Exits the selected mailbox.|
|`1 FETCH <ID> all`|Retrieves data associated with a message in the mailbox.|
|`1 CLOSE`|Removes all messages with the `Deleted` flag set.|
|`1 LOGOUT`|Closes the connection with the IMAP server.|

#### POP3 Commands

|**Command**|**Description**|
|---|---|
|`USER username`|Identifies the user.|
|`PASS password`|Authentication of the user using its password.|
|`STAT`|Requests the number of saved emails from the server.|
|`LIST`|Requests from the server the number and size of all emails.|
|`RETR id`|Requests the server to deliver the requested email by ID.|
|`DELE id`|Requests the server to delete the requested email by ID.|
|`CAPA`|Requests the server to display the server capabilities.|
|`RSET`|Requests the server to reset the transmitted information.|
|`QUIT`|Closes the connection with the POP3 server.|

Basically without credentials we can't use footprint this service, so try to found some before to procede footprinting these two services. 
## SNMP

SNMP (Simple Network Management Protocol) listens on port UDP 161 and also enables the use of called "traps" on port 162. These are some dangerous settings: [[2. FOOTPRINTING_cheatsheet#SNMP]]

|**Settings**|**Description**|
|---|---|
|`rwuser noauth`|Provides access to the full OID tree without authentication.|
|`rwcommunity <community string> <IPv4 address>`|Provides access to the full OID tree regardless of where the requests were sent from.|
|`rwcommunity6 <community string> <IPv6 address>`|Same access as with `rwcommunity` with the difference of using IPv6.|

To footpring the service we can use 3 tools: snmpwalk, onesixtyone and braa.
At first we need a community string. A community string can be seen as passwords that are used to determine the requested information can be viewed or not. So first of all use the tool "onesixtyone".
After we got a community string, we can use "snmpwalk" to list the OID. Look carefully at the output because it can contain important information or it can execute a script that has credentials and so on.
We can also brute force individual OIDs and enumerate information about them with "braa".



## MySQL
MySQL Listens on port  TCP 3306. These are some dangerous settings: [[2. FOOTPRINTING_cheatsheet#MySQL]]

|**Settings**|**Description**|
|---|---|
|`user`|Sets which user the MySQL service will run as.|
|`password`|Sets the password for the MySQL user.|
|`admin_address`|The IP address on which to listen for TCP/IP connections on the administrative network interface.|
|`debug`|This variable indicates the current debugging settings|
|`sql_warnings`|This variable controls whether single-row INSERT statements produce an information string if warnings occur.|
|`secure_file_priv`|This variable is used to limit the effect of data import and export operations

To footpring this service we can start with an nmap scan, with `--script=mysql*` to a deep script scan.
We can try to login with mysql without a password (using root as username) or login with valid credentials. Once in, we can use these commands to extrapulate information:

|**Command**|**Description**|
|---|---|
|`mysql -u <user> -p<password> -h <IP address>`|Connect to the MySQL server. There should **not** be a space between the '-p' flag, and the password.|
|`show databases;`|Show all databases.|
|`use <database>;`|Select one of the existing databases.|
|`show tables;`|Show all available tables in the selected database.|
|`show columns from <table>;`|Show all columns in the selected database.|
|`select * from <table>;`|Show everything in the desired table.|
|`select * from <table> where <column> = "<string>";`|Search for needed `string` i|


## MSSQL

MSSQL Usually listens on port TCP 1433. MSSQL Databases has a default system database that can help us understand the structure of all the databases: [[2. FOOTPRINTING_cheatsheet#MSSQL]]

|Default System Database|Description|
|---|---|
|`master`|Tracks all system information for an SQL server instance|
|`model`|Template database that acts as a structure for every new database created. Any setting changed in the model database will be reflected in any new database created after changes to the model database|
|`msdb`|The SQL Server Agent uses this database to schedule jobs & alerts|
|`tempdb`|Stores temporary objects|
|`resource`|Read-only database containing system objects included with SQL server|

These are some dangerous settings points:

- MSSQL clients not using encryption to connect to the MSSQL server
    
- The use of self-signed certificates when encryption is being used. It is possible to spoof self-signed certificates
    
- The use of [named pipes](https://docs.microsoft.com/en-us/sql/tools/configuration-manager/named-pipes-properties?view=sql-server-ver15)
    
- Weak & default `sa` credentials. Admins may forget to disable this account

If we find some credentials for "sa", this means we found the "System Administrator" hence the "Administrator" account. So we can use it as username.
Once in, we can query:

```shell-session
SQL> select name from sys.databases
```

And proceed further.


## Oracle TNS
The Oracle Transparent Network Substrate (TNS)  server is a communication protocol that facilitates communication betweeen Oracle databases and applications over networks.
It usually listens on port TCP 1521. Some Settings: [[2. FOOTPRINTING_cheatsheet#Oracle TNS]]

|**Setting**|**Description**|
|---|---|
|`DESCRIPTION`|A descriptor that provides a name for the database and its connection type.|
|`ADDRESS`|The network address of the database, which includes the hostname and port number.|
|`PROTOCOL`|The network protocol used for communication with the server|
|`PORT`|The port number used for communication with the server|
|`CONNECT_DATA`|Specifies the attributes of the connection, such as the service name or SID, protocol, and database instance identifier.|
|`INSTANCE_NAME`|The name of the database instance the client wants to connect.|
|`SERVICE_NAME`|The name of the service that the client wants to connect to.|
|`SERVER`|The type of server used for the database connection, such as dedicated or shared.|
|`USER`|The username used to authenticate with the database server.|
|`PASSWORD`|The password used to authenticate with the database server.|
|`SECURITY`|The type of security for the connection.|
|`VALIDATE_CERT`|Whether to validate the certificate using SSL/TLS.|
|`SSL_VERSION`|The version of SSL/TLS to use for the connection.|
|`CONNECT_TIMEOUT`|The time limit in seconds for the client to establish a connection to the database.|
|`RECEIVE_TIMEOUT`|The time limit in seconds for the client to receive a response from the database.|
|`SEND_TIMEOUT`|The time limit in seconds for the client to send a request to the database.|
|`SQLNET.EXPIRE_TIME`|The time limit in seconds for the client to detect a connection has failed.|
|`TRACE_LEVEL`|The level of tracing for the database connection.|
|`TRACE_DIRECTORY`|The directory where the trace files are stored.|
|`TRACE_FILE_NAME`|The name of the trace file.|
|`LOG_FILE`|The file where the log information is stored.|

We can use the `--script=oracle-sid-brute` to enumrate SID. SIDs identifies specific instance of the database the client wants to connect to.
We can also use ODAT to perform a variety of scans to enumerate and gather information about the Oracle database services and its components.
If we found credentials, we can use SQLPlus to login to a specific SID instance of the database. We can also try to use SQLPlus and login "as sydba" to elevate our privileges.





## IPMI
IPMI (Intelligent Platform Management Interface) is a set of standardized specifications for hardware-based host management systems used for system management and monitoring. IPMI listens on port UDP 623. [[2. FOOTPRINTING_cheatsheet#IPMI]]
We can use `--script=ipmi-version` to enumerate IPMI version or the metasploit module for the same result. Here some default credentials: 

|Product|Username|Password|
|---|---|---|
|Dell iDRAC|root|calvin|
|HP iLO|Administrator|randomized 8-character string consisting of numbers and uppercase letters|
|Supermicro IPMI|ADMIN|ADMIN|

We can use the metasploit module
`auxiliary/scanner/ipmi/ipmi_dumphashes`