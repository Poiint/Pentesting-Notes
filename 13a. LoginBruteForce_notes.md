
Here is a small list of files that can contain hashed passwords:

|**`Windows`**|**`Linux`**|
|---|---|
|unattend.xml|shadow|
|sysprep.inf|shadow.bak|
|SAM|password|


# Basic HTTP Auth Brute Forcing

## Default Passwords
Basically we try default users and password to see if we are succesfull. We talk for creds like 'admin:admin' and so on. 'SecLists' has a good wordlist for that placed in `/usr/share/wordlists/Seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt` (it's a passlist, so with hydra we need to specify '-C'). Also, when talking about HTTP login brute force, it provides two auth mechanics:
The HTTP specification provides two parallel authentication mechanisms:

1. `Basic HTTP AUTH` is used to authenticate the user to the HTTP server.
    
2. `Proxy Server Authentication` is used to authenticate the user to an intermediate proxy server.

If the website requires a standard HTTP authentication, we can use the `http-get` method in `hydra`, specifying also the directory (for example: `/` (root)).
An example of a HTTP auth bruteforce:
```shell-session
Poiint@htb[/htb]$ hydra -C /opt/useful/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 178.211.23.155 -s 31099 http-get /
```


## Username/Password Brute Force
Instead of a passlist, we can specify a single wordlist for username brute force and the same for password. This is `hydra` syntax:
- `-l` : for a single username
- `-L` : for a list of usernames
- `-p` : for a single password
- `-P` : for a list of passwords
- `-u` : try one password for each user (default option is the opposite)
- `-f` : stop at the first finding

We can find related wordlists in Seclists under respectively the `<SNIP>/Usernames/Names` and `<SNIP>/Passwords/Leaked-Databases/` (or generally `rockyou.txt` for passwords).

An example of a brute force attack:

```shell-session
Poiint@htb[/htb]$ hydra -L /opt/useful/SecLists/Usernames/Names/names.txt -P /opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt -u -f 178.35.49.134 -s 32901 http-get /
```



# Web Forms Brute Force
In case of POST authentication (using php), we can use the `http-post-form` module in `hydra` in order to do brute force. We need to specify 3 parameters separated by `:` in order to be succesful:
1. `URL path`, which holds the login form
2. `POST parameters` for username/password
3. `A failed/success login string`, which lets hydra recognize whether the login attempt was successful or not

For example, for the URL:
```shell-session
/login.php
```

for the POST parameters:
```shell-session
/login.php:[user parameter]=^USER^&[password parameter]=^PASS^
```

for the failed/success login string:
```shell-session
/login.php:[user parameter]=^USER^&[password parameter]=^PASS^:[FAIL/SUCCESS]=[success/failed string]
```

The first parameter is immediate; the second parameter can be obtained by intercepting a request via burpsuite or by using the developer tools (F11) in the web browser and looking in the networking tab (for example, user parameter could be `username` and password parameter could be `password`); the third parameter has to be crafted: we need to specify a `Fail` or `Success` string (imho i think we most likely are going to use a `Fail` string), this means we need to specify a "matching string" that will tell hydra if the request was succesful or not. An example could be:

```
"<SNIP>F=<form name='login'"
```

This means that, if in the response of the brute force, hydra sees that string, it means it's a failure, so the brute force attack failed. For this specific parameter we should pay attention since it's gonna change from website to website, using a form name string is a good idea, since in case of succesful login, it's very likely not going to be inside the authenticated HTML page.
A final example:
```shell-session
"/login.php:[user parameter]=^USER^&[password parameter]=^PASS^:F=<form name='login'"
```

Now that we have that parameter set, we need to specify the other usual information:

```shell-session
Poiint@htb[/htb]$ hydra -l admin -P /opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt -f 178.35.49.134 -s 32901 http-post-form "/login.php:username=^USER^&password=^PASS^:F=<form name='login'"
```

This is an example of an attack to a "login.php" page.

# Service Authentication Attacks

When attacking services (i think also web forms lol) we can use personalized wordlists. In order to do that, we can use `cupp`. By starting cupp with `cupp -i` we can provide "First Name", "Surname", "Nicknames" and so on, so we need to do some OSINT of the target (like Bill Gates, or Harry Potter). We can also add some special chars, numbers and leet mode. This could be our password list.
For the userlist, we can use a tool like `username-anarchy` and we need only to specify a user
```shell-session
Poiint@htb[/htb]$ ./username-anarchy Harry Potter > potter.txt
```

Once finished, we can retrieve the password policy (we can obtain it in some ways). For example, if a password policy is:
- 8 characters or longer
we can use the command:
```shell-session
sed -ri '/^.{,7}$/d' harry.txt
```
- contains special characters
we can use the command:
```shell-session
sed -ri '/[!-/:-@\[-`\{-~]+/!d' harry.txt
```
- contains numbers
we can use the command
```shell-session
sed -ri '/[0-9]+/!d' harry.txt 
```

This will reduce our original wordlist by a lot. We can still create many permutations with tools like [rsmangler](https://github.com/digininja/RSMangler) or [The Mentalist](https://github.com/sc0tfree/mentalist.git). These tools have many other options, which can make any small wordlist reach millions of lines long, but this will increase the attack time, so, always try to be efficient, and properly customize your wordlist (try to use the simplest to the most complex ones).
Attacking services is really easy, we just need to specify the service, the IP and (if not default) the port. for example:
```shell-session
Poiint@htb[/htb]$ hydra -L potter.txt -P harry.txt -u -f ssh://178.35.49.134:22 -t 4
```

NB: when attacking SSH, use 4 threads since using more could kill sessions and having false negatives. Also having more than 4 threads could kill other connections (in case you have more services, better attack FTP or lighter services).
Once you login into the host, you can look for local services with
```shell-session
harry.potter@bruteforcing:~$ netstat -antp | grep -i list
```

if you find a line like this
```shell-session
tcp        0      0 127.0.0.1:21            0.0.0.0:*               LISTEN      - 
```
it means that FTP (port 21) is listening (on localhost 127.0.0.1). This mean you can also bruteforce that service and get a new set of creds for another user (for example, "g.potter"), but this is probably something more related to privilage escalation?